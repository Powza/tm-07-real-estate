$(function() {
  // Lazyload
  function lazyLoad() {
    var lazyLoadInstance = new LazyLoad({
      elements_selector: ".lazy",
      threshold: 150
    });
  }
  lazyLoad();

  // Sidebar Scroll List Box
  function sidebarScrollList() {
    $(".sidebar__list-scroll").each(function(i) {
      $(this).attr("id", "list" + i);
    });
    $(".sidebar__list-scroll .list-slider ul").each(function(i, item) {
      var slidesShowScroll = $(this)
        .parent()
        .data("list-items");
      slidesShowScroll =
        slidesShowScroll <= 0 ? (slidesShowScroll = 1) : slidesShowScroll;
      if (slidesShowScroll == null) {
        slidesShowScroll = 6;
      }
      var carouselId = "carousel" + i;
      this.id = carouselId;
      $(this).slick({
        rows: 0,
        vertical: true,
        verticalSwiping: true,
        slidesToShow: slidesShowScroll,
        slidesToScroll: slidesShowScroll,
        prevArrow:
          '<button type="button" class="slick-prev btn btn__light__outline btn__outline"><i class="fa fa-angle-up"></i></button>',
        nextArrow:
          '<button type="button" class="slick-next btn btn__light__outline btn__outline"><i class="fa fa-angle-down"></i></button>',
        appendArrows: $("<div></div>")
          .addClass("section__slider-arrows")
          .appendTo(".sidebar__list-scroll#list" + i + " h4")
      });
    });
  }
  sidebarScrollList();

  // Sidebar Multilevel List Box
  function multilevelList() {
    $(".sidebar__multilevel-list").each(function(i) {
      $(this).attr("id", "multilevel_" + i);
      $("ul:first", this)
        .smartmenus("destroy")
        .removeAttr("id class style")
        .addClass("sm sm-vertical-list")
        .smartmenus();
    });
  }
  multilevelList();

  // Sidebar MultiLevelMenus List Box
  function multiLevelMenusList() {
    $(".sidebar__multilevelmenus-list").each(function(i) {
      $(this).attr("id", "multilevelmenus_" + i);
    });
    $(".sidebar__multilevelmenus-list .panel-group").each(function(i) {
      $(this).attr("id", "panel-group_" + i);
      $(".panel-title a", this).attr("data-parent", "#panel-group_" + i);
    });
    $(".sidebar__multilevelmenus-list .panel-title a").each(function(i) {
      $(this)
        .attr("href", "#collapse_" + i)
        .attr("aria-controls", "collapse_" + i)
        .attr("aria-expanded", "false");
    });
    $(".sidebar__multilevelmenus-list .panel-heading").each(function(i) {
      $(this).attr("id", "heading_" + i);
    });
    $(".sidebar__multilevelmenus-list .panel-collapse").each(function(i) {
      $(this)
        .attr("id", "collapse_" + i)
        .attr("aria-labelledby", "heading_" + i);
      $("ul:first", this)
        .smartmenus("destroy")
        .removeAttr("id class style")
        .addClass("sm sm-vertical-list")
        .smartmenus();
    });
  }
  multiLevelMenusList();

  // Homepage Property Slider
  function propertySlider() {
    $(".property-slider:not(.sidebar .property-slider)").each(function(i) {
      $(this).attr("id", "slide_" + i);
    });
    $(".property-slider:not(.sidebar .property-slider) .slider-wrap").each(
      function(i) {
        var carouselId = $(this).attr("id", "carousel_" + i);
        carouselId.on("init reInit afterChange", function(
          event,
          slick,
          currentSlide,
          nextSlide
        ) {
          lazyLoad();
        });
        carouselId.slick({
          slidesToShow: 4,
          slidesToScroll: 4,
          rows: 2,
          prevArrow:
            '<button type="button" class="slick-prev btn btn__primary__outline btn__outline"><i class="fa fa-angle-left"></i> Prev</button>',
          nextArrow:
            '<button type="button" class="slick-next btn btn__primary__outline btn__outline">Next <i class="fa fa-angle-right"></i></button>',
          appendArrows: $("<div></div>")
            .addClass("section__slider-arrows")
            .appendTo($(this).parent()),
          responsive: [
            {
              breakpoint: 1680,
              settings: {
                slidesToShow: 3,
                slidesToScroll: 3,
                rows: 2,
                slidesPerRow: 1
              }
            },
            {
              breakpoint: 992,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 2,
                rows: 1,
                slidesPerRow: 1
              }
            },
            {
              breakpoint: 767,
              settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                rows: 1,
                slidesPerRow: 1
              }
            }
          ]
        });
      }
    );
  }
  propertySlider();

  // Sidebar Property Slider
  function propertySliderSidebar() {
    $(".sidebar .property-slider").each(function(i) {
      $(this).attr("id", "sidebar_slide_" + i);
      $(".sidebar .property-slider#sidebar_slide_" + i + " .slider-wrap").html(
        $(".sidebar .property-slider .item").sort(function() {
          return Math.random() - 0.5;
        })
      );
    });
    $(".sidebar .property-slider .slider-wrap").each(function(i) {
      var carouselId = "carousel_" + i;
      this.id = carouselId;
      $(this).slick({
        rows: 0,
        adaptiveHeight: true,
        prevArrow:
          '<button type="button" class="slick-prev btn btn__primary__outline btn__outline"><i class="fa fa-angle-left"></i> Prev</button>',
        nextArrow:
          '<button type="button" class="slick-next btn btn__primary__outline btn__outline">Next <i class="fa fa-angle-right"></i></button>',
        appendArrows: $("<div></div>")
          .addClass("section__slider-arrows")
          .appendTo($(this).parent())
      });
    });
  }
  propertySliderSidebar();

  // Homepage Agent Slider
  function agentSlider() {
    "use strict";
    $(".agent-slider:not(.sidebar .agent-slider)").each(function(i) {
      $(this).attr("id", "slide_" + i);
      let agentSort = $.trim($(this).data("agent-sort"));
      if (agentSort.toLowerCase() == "random") {
        $(
          ".agent-slider:not(.sidebar .agent-slider)#slide_" +
            i +
            " .slider-wrap"
        ).html(
          $(
            ".agent-slider:not(.sidebar .agent-slider)#slide_" +
              i +
              " .slider-wrap .agent"
          ).sort(function() {
            return Math.random() - 0.5;
          })
        );
      }
      let agentPrimary = $.trim($(this).data("agent-primary"));
      $(
        ".agent-slider:not(.sidebar .agent-slider)#slide_" +
          i +
          " .slider-wrap .agent"
      ).each(function() {
        let agentId = $(".agent__name", this).data("agent-id");
        if (agentPrimary == agentId) {
          $(this)
            .parent()
            .prepend(this);
        }
      });
    });
    $(".agent-slider:not(.sidebar .agent-slider) .slider-wrap").each(function(
      i,
      item
    ) {
      var carouselId = $(this).attr("id", "carousel_" + i);
      carouselId.on("init reInit afterChange", function(
        event,
        slick,
        currentSlide,
        nextSlide
      ) {
        lazyLoad();
      });
      carouselId.slick({
        rows: 0,
        slidesToShow: 5,
        slidesToScroll: 5,
        prevArrow:
          '<button type="button" class="slick-prev btn btn__primary__outline btn__outline"><i class="fa fa-angle-left"></i> Prev</button>',
        nextArrow:
          '<button type="button" class="slick-next btn btn__primary__outline btn__outline">Next <i class="fa fa-angle-right"></i></button>',
        appendArrows: $("<div></div>")
          .addClass("section__slider-arrows")
          .appendTo($(this).parent()),
        responsive: [
          {
            breakpoint: 1680,
            settings: {
              slidesToShow: 4,
              slidesToScroll: 4
            }
          },
          {
            breakpoint: 1440,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 3
            }
          },
          {
            breakpoint: 1100,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 3
            }
          },
          {
            breakpoint: 992,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 2
            }
          },
          {
            breakpoint: 767,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          }
        ]
      });
    });
  }
  agentSlider();

  // Sidebar Agent Slider
  function agentSliderSidebar() {
    "use strict";
    $(".sidebar .agent-slider").each(function(i) {
      $(this).attr("id", "sidebar_slide_" + i);
      let agentSort = $.trim($(this).data("agent-sort"));
      if (agentSort.toLowerCase() == "random") {
        $(".agent-slider#sidebar_slide_" + i + " .slider-wrap").html(
          $(".agent-slider#sidebar_slide_" + i + " .slider-wrap .agent").sort(
            function() {
              return Math.random() - 0.5;
            }
          )
        );
      }
      let agentPrimary = $.trim($(this).data("agent-primary"));
      $(".agent-slider#sidebar_slide_" + i + " .slider-wrap .agent").each(
        function() {
          let agentId = $(".agent__name", this).data("agent-id");
          if (agentPrimary == agentId) {
            $(this)
              .parent()
              .prepend(this);
          }
        }
      );
    });
    $(".sidebar .agent-slider .slider-wrap").each(function(i, item) {
      var carouselId = $(this).attr("id", "carousel_" + i);
      carouselId.on("init reInit afterChange", function(
        event,
        slick,
        currentSlide,
        nextSlide
      ) {
        lazyLoad();
      });
      carouselId.slick({
        rows: 0,
        adaptiveHeight: true,
        prevArrow:
          '<button type="button" class="slick-prev btn btn__primary__outline btn__outline"><i class="fa fa-angle-left"></i> Prev</button>',
        nextArrow:
          '<button type="button" class="slick-next btn btn__primary__outline btn__outline">Next <i class="fa fa-angle-right"></i></button>',
        appendArrows: $("<div></div>")
          .addClass("section__slider-arrows")
          .appendTo($(this).parent())
      });
    });
  }
  agentSliderSidebar();

  // RoyalSlider Fullscreen Hide Header
  function royalSliderFullscreen() {
    if ($(".listings_view .royalSlider").length) {
      var slider = $(".royalSlider").data("royalSlider");
      slider.ev.on("rsEnterFullscreen", function() {
        $(".header").hide();
      });
      slider.ev.on("rsExitFullscreen", function() {
        $(".header").show();
      });
    }
  }
  royalSliderFullscreen();

  // svg4everybody
  svg4everybody();

  // SmartMenus
  $(
    ".header__meta #main_navigation, .mobile-menu #main_navigation"
  ).smartmenus();

  // Mobile Navigation
  $(".header__mobile-menu-btn").click(function(e) {
    e.preventDefault();
    $(".mobile-menu").toggleClass("mobile-menu__open");
    $("body").toggleClass("mobile-menu-open");
    $(this).toggleClass("open");
  });

  // Navbar Scroll
  function headerHeadroom() {
    var header = document.querySelector(".header__meta");

    if (window.location.hash) {
      header.classList.add("headroom--unpinned");
    }
    var headroom = new Headroom(header, {
      tolerance: {
        down: 10,
        up: 20
      },
      offset:
        $(".admin-navbar").outerHeight() + $(".header__company").outerHeight()
    });
    headroom.init();
  }
  headerHeadroom();

  // Responsive Embed
  function responsiveVideoEmbed() {
    var videoSelectors = [
      //'iframe[src*="player.vimeo.com"]',
      'iframe[src*="youtube.com"]',
      'iframe[src*="youtube-nocookie.com"]',
      'iframe[src*="kickstarter.com"][src*="video.html"]',
      'iframe[src*="screenr.com"]',
      'iframe[src*="blip.tv"]',
      'iframe[src*="dailymotion.com"]',
      'iframe[src*="viddler.com"]',
      'iframe[src*="qik.com"]',
      'iframe[src*="revision3.com"]',
      'iframe[src*="hulu.com"]',
      'iframe[src*="funnyordie.com"]',
      'iframe[src*="flickr.com"]',
      'embed[src*="v.wordpress.com"]'
    ];
    var allVideos = videoSelectors.join(",");
    $(allVideos).wrap('<span class="fluid-video" />');
  }
  responsiveVideoEmbed();

  // Enable tooltips
  $('[data-toggle="tooltip"]').tooltip({
    delay: {
      show: 100,
      hide: 500
    }
  });

  // Homepage Agent Testimonials
  function agentTestimonials() {
    $(".testimonials-slider .slider-wrap").html(
      $(".testimonials-slider blockquote").sort(function() {
        return Math.random() - 0.5;
      })
    );
    $(".testimonials-slider .slider-wrap").slick({
      rows: 0,
      centerMode: true,
      centerPadding: "300px",
      adaptiveHeight: true,
      prevArrow:
        '<button type="button" class="slick-prev btn btn__primary__outline btn__outline"><i class="fa fa-angle-left"></i> Prev</button>',
      nextArrow:
        '<button type="button" class="slick-next btn btn__primary__outline btn__outline">Next <i class="fa fa-angle-right"></i></button>',
      appendArrows: $("<div></div>")
        .addClass("section__slider-arrows")
        .appendTo(".testimonials-slider"),
      responsive: [
        {
          breakpoint: 1680,
          settings: {
            centerPadding: "300px"
          }
        },
        {
          breakpoint: 1280,
          settings: {
            centerMode: false
          }
        }
      ]
    });
  }
  agentTestimonials();

  // Hero Slider
  function heroImage() {
    $(".hero__media__slider .slider").slick({
      rows: 0,
      fade: true,
      autoplay: true,
      autoplaySpeed: 10000,
      arrows: false,
      dots: true,
      appendDots: $("<div></div>")
        .addClass("section__slider-dots hidden-xs hidden-sm")
        .appendTo(".hero__container")
    });
  }

  // Hero Video
  function heroVideo() {
    var videoContainer = ".hero__video";
    $(videoContainer).YTPlayer({
      videoURL: $(videoContainer).data("video-url"),
      containment: videoContainer,
      loop: true,
      mute: true,
      autoPlay: true,
      showControls: false,
      abundance: 0,
      useOnMobile: false,
      stopMovieOnBlur: false,
      // startAt: 20,
      // stopAt: 25,
      playOnlyIfVisible: false,
      onScreenPercentage: 100
    });
  }

  // Check if media type is defind and default if empty
  function heroMediaCheck() {
    var checkMediaType = $.trim($(".hero__media").data("media-type"));
    if (checkMediaType == "video") {
      $(".hero__media__slider").remove();
      $(".hero__media__video").show();
      $.getScript("/js/jquery.mb.ytplayer.min.js", function() {
        heroVideo();
      });
    } else if (checkMediaType == "image") {
      $(".hero__media__video").remove();
      $(".hero__media__slider").show();
      heroImage();
    } else {
      $(".hero__media__video").remove();
      $(".hero__media__slider").show();
      heroImage();
    }
  }
  heroMediaCheck();

  // hero padding
  function headerCalculateHeroPadding() {
    var headerHeight = $(".header").outerHeight();
    var adminHeight = $(".admin-navbar").outerHeight();
    var navHeight = $(".header__meta").outerHeight();
    var total = headerHeight + adminHeight + navHeight;

    if ($(window).width() < 992) {
      $(".hero").css("min-height", "calc(100vh - " + headerHeight + "px)");
    } else if ($(window).width() > 993) {
      $(".hero").css("min-height", "calc(100vh - " + total + "px)");
    }
  }
  $(window).resize(function() {
    headerCalculateHeroPadding();
  });
  headerCalculateHeroPadding();

  // Search Suggest
  function quickSearchSuggest() {
    $("#qs_suggest").each(function(i) {
      $(".mls-loading-results").hide();
      $(this).magicSuggest({
        hideTrigger: true,
        minChars: 2,
        maxSuggestions: 100,
        allowFreeEntries: true,
        placeholder: "Search by MLS # or Address",
        maxSelection: 15,
        inputCfg: { autocomplete: "true" },
        name: "data[Listing][mlsnumbers]",
        data: "/listings/ajax_mlsdata",
        displayField: "name",
        renderer: function(a) {
          if (typeof a.display == "undefined" || a.display == "") {
            return a.id;
          } else {
            return a.display;
          }
        },
        selectionRenderer: function(a) {
          if (typeof a.display == "undefined" || a.display == "") {
            return a.id;
          } else {
            return a.display;
          }
        }
      });
      $(this).on("beforeload", function() {
        $(".mls-loading-results").show();
      });

      $(this).on("load", function() {
        $(".mls-loading-results").hide();
      });
    });
  }
  quickSearchSuggest();

  // Mobile Search Suggest
  function mobileQuickSearchSuggest() {
    var width = $(window).width();

    if (width <= 991) {
      $(window).scroll(function(e) {
        e.preventDefault();
        var x = $(this).scrollTop();
        if (x >= 50) {
          $(".mls-search").addClass("mls-search-hide");
        } else {
          $(".mls-search").removeClass("mls-search-hide");
        }
      });
    }
  }
  mobileQuickSearchSuggest();

  $(window).resize(function() {
    mobileQuickSearchSuggest();
  });

  // Quicksearch Single Select
  $(".qs-single-select").selectize({
    create: false,
    hideSelected: true,
    allowEmptyOption: true,
    placeholder: $(this).data("placeholder")
  });

  // Quicksearch Multiple Select
  $("#qs_form .multi-select.placeholder").remove();
  $("#qs_form .multi-select").show();
  $("#qs_form .multi-select").multipleSelect({
    minimumCountSelected: 2,
    placeholder: $(this).data("placeholder"),
    selectAll: $(this).data("select-all")
  });
});
