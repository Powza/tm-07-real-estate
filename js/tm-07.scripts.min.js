$(function(){
    // Open listings Map view if URL hash
    if (window.location.hash === '#map') {
        $('#ml_m').click();
    }

    if ($('#listings').length) {
        $('#ml_m', this).click();
    }

    // Open agent profile testimonials if URL hash
    if (window.location.hash === '#agentTestimonials') {
        if ($('#tab-testimonials').is(':visible')) {
            $('.nav-tabs a[href="#testimonials"]').click();
        }
    }

    // Open agent profile testimonials if testimonials avalible
    if ($('#tab-testimonials').is(':visible')) {
        $('.nav-tabs a[href="#testimonials"]').click();
    }

    // Agent Bio show full
    if ($('.agent-bio').length) {
    	$('.agent-bio').readmore('destroy');
    }

    function activeTabs() {
        var path = window.location.pathname;

        if (path === '/') { $('.navbar-nav a[title="Home"]').parent().addClass('active'); }
        else if (path === '/agents.html') { $('.navbar-nav a[href="/contact.html"]').parent().addClass('active'); }
        else if (path === '/contact.html') { $('.navbar-nav a[href="/contact.html"]').parent().addClass('active'); }
        else if (path === '/selecting-a-real-estate-agent') { $('.navbar-nav a[title="Selling"]').parent().addClass('active'); }
        else if (path === '/free-market-analysis') { $('.navbar-nav a[title="Selling"]').parent().addClass('active'); }
        else if (path === '/let-us-help-you') { $('.navbar-nav a[title="Buying"]').parent().addClass('active'); }
        else if (path === '/steps-to-the-home-search-process') { $('.navbar-nav a[title="Buying"]').parent().addClass('active'); }
        else if (path === '/submitting-an-offer') { $('.navbar-nav a[title="Buying"]').parent().addClass('active'); }
        else if (path === '/free-e-book-renting-vs-buying') { $('.navbar-nav a[title="Buying"]').parent().addClass('active'); }
        else if (path === '/mortgage-rates') { $('.navbar-nav a[title="Buying"]').parent().addClass('active'); }
        else if (path === '/submitting-an-offer') { $('.navbar-nav a[title="Buying"]').parent().addClass('active'); }
        else if (path === '/property-search.html') { $('.navbar-nav a[title="Property Search"]').parent().addClass('active'); }
        else if (path === '/search-by-area.html') { $('.navbar-nav a[title="Property Search"]').parent().addClass('active'); }
        else if (path === '/search-by-map.html') { $('.navbar-nav a[title="Property Search"]').parent().addClass('active'); }
        else if (path === '/search-by-subdivision.html') { $('.navbar-nav a[title="Property Search"]').parent().addClass('active'); }
        else if (path === '/search-by-mls-address.html') { $('.navbar-nav a[title="Property Search"]').parent().addClass('active'); }
        else if (path === '/search-by-school.html') { $('.navbar-nav a[title="Property Search"]').parent().addClass('active'); }
        else if (path === '/search-by-zipcode.html') { $('.navbar-nav a[title="Property Search"]').parent().addClass('active'); }
        else if (path === '/listings-by-city') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/branson-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/branson-west-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/blue-eye-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/bradleyville-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/cedar-creek-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/cape-fair-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/chestnut-ridge-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/forsyth-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/hollister-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/kirbyville-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/kissee-mills-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/merriam-woods-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/powersite-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/protem-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/reeds-spring-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/ridgedale-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/rockaway-beach-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/saddlebrooke-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/taneyville-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
        else if (path === '/walnut-shade-mo-real-estate-listings') { $('.navbar-nav a[href="/listings-by-city"]').parent().addClass('active'); }
    }
    activeTabs();

    // Use listing image as background image
    function propertyDetailsHeader() {
        if($('.listings_view .royalSlider').length) {
            var imgURL = $('.listings_view .royalSlider .rsNavSelected img').attr('src');
            $('.banner.section__background').css('background-image', 'url('+imgURL+')');
        }
    }
    propertyDetailsHeader();

    // Sidebar Scoll List Box
    function sidebarScrollList() {
        $(".sidebar .sidebar__list-scroll").each(function(i) {
            $(this).attr('id', 'list' + i);
            $('.sidebar .sidebar__list-scroll#list' + i + ' ul').html($('.sidebar .sidebar__list-scroll#list' + i + ' ul li').sort(function(){
                return Math.random()-0.5;
            }));
        });
        $(".sidebar .sidebar__list-scroll .list-slider ul").each(function(i, item) {
            var carouselId = "carousel" + i;
            this.id = carouselId;
            $(this).slick({
                slide: "#" + carouselId +" li",
                vertical: true,
                verticalSwiping: true,
                slidesToShow: 6,
                slidesToScroll: 6,
                prevArrow: '<button type="button" class="slick-prev btn btn__light__outline"><i class="fa fa-angle-up"></i></button>',
                nextArrow: '<button type="button" class="slick-next btn btn__light__outline"><i class="fa fa-angle-down"></i></button>',
                appendArrows: $('<div></div>').addClass('section__slider-arrows').appendTo('.sidebar__list-scroll#list' + i + ' h4'),
            });
        });
    }
    sidebarScrollList();

    // Homepage Property Slider
    function propertySlider() {
        $(".property-slider").each(function(i) {
            $(this).attr('id', 'slide' + i);
            $('.property-slider#slide' + i + ' .prop-img').Lazy({
                scrollDirection: 'vertical',
                threshold: 0,
            });
        });
        $(".property-slider .slider-wrap").each(function(i, item) {
            var carouselId = "carousel" + i;
            this.id = carouselId;
            $(this).slick({
                slide: "#" + carouselId +" .item",
                slidesToShow: 4,
                slidesToScroll: 4,
                prevArrow: '<button type="button" class="slick-prev btn btn__primary__outline"><i class="fa fa-angle-left"></i> Prev</button>',
                nextArrow: '<button type="button" class="slick-next btn btn__primary__outline">Next <i class="fa fa-angle-right"></i></button>',
                appendArrows: $('<div></div>').addClass('section__slider-arrows').appendTo('.property-slider#slide' + i),
                responsive: [
                {
                    breakpoint: 1680,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 3,
                  }
                },
                {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 2
                  }
                },
                {
                    breakpoint: 767,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1
                  }
                }
                ]
            });
        });
        
    }
    propertySlider();

    // Homepage Agent Slider
    function agentSlider() {
        $('.agent-slider .slider-wrap').html($('.agent-slider .slider-wrap .agent').sort(function(){
            return Math.random()-0.5;
        }));
        $('.agent-slider .agent-img').Lazy({
            scrollDirection: 'vertical'
        });
        $('.agent-slider .slider-wrap').slick({
            slidesToShow: 4,
            slidesToScroll: 4,
            prevArrow: '<button type="button" class="slick-prev btn btn__primary__outline"><i class="fa fa-angle-left"></i> Prev</button>',
            nextArrow: '<button type="button" class="slick-next btn btn__primary__outline">Next <i class="fa fa-angle-right"></i></button>',
            appendArrows: $('<div></div>').addClass('section__slider-arrows').appendTo('.agent-slider'),
            responsive: [
            {
                breakpoint: 1680,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3,
              }
            },
            {
                breakpoint: 992,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 2
              }
            },
            {
                breakpoint: 767,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
              }
            }
            ]
        });
    }
    agentSlider();

    // svg4everybody
    svg4everybody();
    
    // SmartMenus
	$('.header #main_navigation').smartmenus();
	$('.mobile-menu #main_navigation').smartmenus();

	// Mobile Navigation
    $('.header__mobile-menu-btn').click(function (e) {
        e.preventDefault();
        $('.mobile-menu').toggleClass('mobile-menu__open');
        $('body').toggleClass('mobile-menu-open');
        $(this).toggleClass('open');
    });

    // Quicksearch Single Select
    $('.qs-single-select').selectize({
        create: false,
        hideSelected: true,
        allowEmptyOption: true,
        placeholder: $(this).data('placeholder'),
    });

    // Quicksearch Multiple Select
    $('#qs_form .multi-select.placeholder').remove();
    $('#qs_form .multi-select').show();
    $('#qs_form .multi-select').multipleSelect({
        minimumCountSelected: 2,
        placeholder: $(this).data('placeholder'),
    });

	// Scroll Navigation Menu
    $(window).scroll(function () {
        var scroll = $(this).scrollTop();
        var topDist = $(".start-scroll").position();
        if (scroll > $('header').outerHeight()) {
            $('.header__meta').addClass('fixed');
        } else {
            $('.header__meta').removeClass('fixed');
        }
    });

    // Hide Header on scroll down
    function headerMenuScroll() {
        var didScroll;
        var lastScrollTop = 0;
        var delta = 46;
        var navbarHeight = $('header').outerHeight();

        $(window).scroll(function(event){
            didScroll = true;
        });

        setInterval(function() {
            if (didScroll) {
                hasScrolled();
                didScroll = false;
            }
        }, 0);

        function hasScrolled() {
            var st = $(this).scrollTop();
            
            // Make sure they scroll more than delta
            if(Math.abs(lastScrollTop - st) <= delta)
                return;
            
            if (st > lastScrollTop && st > navbarHeight){
                // Scroll Down
                $('.header__meta').css({'opacity':'0', 'transform':'translateY(-100%)'});
            } else {
                // Scroll Up
                if(st + $(window).height() < $(document).height()) {
                    $('.header__meta').css({'opacity':'1', 'transform':'translateY(0)'});
                }
            }
            
            lastScrollTop = st;
        }
    }
    headerMenuScroll();

    // Header padding
    function headerCalculateContentPadding() {
		$('body.int').css( 'padding-top', $( '.header' ).height() +'px');
	}
	$(window).resize(function() {
		headerCalculateContentPadding();
	});
	headerCalculateContentPadding();

	// Responsive Embed
  	function responsiveVideoEmbed() {
        var videoSelectors = [
            //'iframe[src*="player.vimeo.com"]',
            'iframe[src*="youtube.com"]',
            'iframe[src*="youtube-nocookie.com"]',
            'iframe[src*="kickstarter.com"][src*="video.html"]',
            'iframe[src*="screenr.com"]',
            'iframe[src*="blip.tv"]',
            'iframe[src*="dailymotion.com"]',
            'iframe[src*="viddler.com"]',
            'iframe[src*="qik.com"]',
            'iframe[src*="revision3.com"]',
            'iframe[src*="hulu.com"]',
            'iframe[src*="funnyordie.com"]',
            'iframe[src*="flickr.com"]',
            'embed[src*="v.wordpress.com"]'
        ];
        var allVideos = videoSelectors.join(',');
        $(allVideos).wrap('<span class="fluid-video" />');
    };
    responsiveVideoEmbed();

  	// Enable tooltips
    $('[data-toggle="tooltip"]').tooltip({
        delay: {
            "show": 500,
            "hide": 500
        }
    });

    // Hero Slider
    function heroImage() {
        $('.hero__media__slider .slider').slick({
            fade: true,
            autoplay: true,
            autoplaySpeed: 10000,
            prevArrow: '<button type="button" class="slick-prev"><svg role="img" title="Left Arrow"><use xlink:href="img/tm-07/icon-pack.svg#left-arrow"></use></svg></button>',
            nextArrow: '<button type="button" class="slick-next"><svg role="img" title="Right Arrow"><use xlink:href="img/tm-07/icon-pack.svg#right-arrow"></use></svg></button>',
            appendArrows: $('<div></div>').addClass('section__slider-arrows hidden-xs').appendTo('.hero__search__links'),
        });
    }

    // Hero Video
    function heroVideo() {
        var videoContainer = '.hero__video';
        $(videoContainer).YTPlayer({
            videoURL: $(videoContainer).data('video-url'),
            containment: videoContainer,
            loop: true,
            autoPlay: true,
            showControls: false,
            abundance: 0,
            ratio: 'auto',
            quality: 'default',
            stopMovieOnBlur: false,
            playOnlyIfVisible: true,
        });
    }

    // Check if media type is defind and default if empty
    function heroMediaCheck() {
        var checkMediaType = $.trim($('.hero__media').data('media-type'));
        if(checkMediaType == 'video'){
            $('.hero__media__slider').remove();
            $('.hero__media__video').show();
            heroVideo();
        } else if(checkMediaType == 'image'){
            $('.hero__media__video').remove();
            $('.hero__media__slider').show();
            heroImage();
        } else {
            $('.hero__media__video').remove();
            $('.hero__media__slider').show();
            heroImage();
        }
    }
    heroMediaCheck();

    // Lazyload
    $('.section__lazyload').Lazy();

    function mapSearchPropertiesCollapse() {
        $('.dynidx-map-container .map-view #map').prepend('<a href="" class="btn hidden-xs" data-toggle="map-expand" data-state="open"></a>');
        $('a[data-toggle="map-expand"]').click(function() {
            $(this).attr('data-state', $(this).attr('data-state') == 'open' ? 'closed' : 'open');
            $('.dynidx-map-container').toggleClass('expanded-map');
            return false;
        });
    }
    mapSearchPropertiesCollapse();

});