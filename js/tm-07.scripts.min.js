$(function(){
    // svg4everybody
    svg4everybody();
    
    // SmartMenus
	$('.header #main_navigation').smartmenus();
	$('.mobile-menu #main_navigation').smartmenus();

	// Mobile Navigation
    $('.header__mobile-menu-btn').click(function (e) {
        e.preventDefault();
        $('.mobile-menu').toggleClass('mobile-menu__open');
        $('body').toggleClass('mobile-menu-open');
        $(this).toggleClass('open');
    });

	//$('.agent-bio').readmore('destroy');

	// Scroll Navigation Menu
    $(window).scroll(function () {
        var scroll = $(this).scrollTop();
        var topDist = $(".start-scroll").position();
        if (scroll > $('header').outerHeight()) {
            $('.header__meta').addClass('fixed');
        } else {
            $('.header__meta').removeClass('fixed');
        }
    });

    // Hide Header on scroll down
    function headerMenuScroll() {
        var didScroll;
        var lastScrollTop = 0;
        var delta = 46;
        var navbarHeight = $('header').outerHeight();

        $(window).scroll(function(event){
            didScroll = true;
        });

        setInterval(function() {
            if (didScroll) {
                hasScrolled();
                didScroll = false;
            }
        }, 0);

        function hasScrolled() {
            var st = $(this).scrollTop();
            
            // Make sure they scroll more than delta
            if(Math.abs(lastScrollTop - st) <= delta)
                return;
            
            if (st > lastScrollTop && st > navbarHeight){
                // Scroll Down
                $('.header__meta').css({'opacity':'0', 'transform':'translateY(-100%)'});
            } else {
                // Scroll Up
                if(st + $(window).height() < $(document).height()) {
                    $('.header__meta').css({'opacity':'1', 'transform':'translateY(0)'});
                }
            }
            
            lastScrollTop = st;
        }
    }
    headerMenuScroll();

    // Header padding
    function headerCalculateContentPadding() {
		$('body.int').css( 'padding-top', $( '.header' ).height() +'px');
	}
	$(window).resize(function() {
		headerCalculateContentPadding();
	});
	headerCalculateContentPadding();

	// Responsive Embed
  	function responsiveVideoEmbed() {
        var videoSelectors = [
            'iframe[src*="player.vimeo.com"]',
            'iframe[src*="youtube.com"]',
            'iframe[src*="youtube-nocookie.com"]',
            'iframe[src*="kickstarter.com"][src*="video.html"]',
            'iframe[src*="screenr.com"]',
            'iframe[src*="blip.tv"]',
            'iframe[src*="dailymotion.com"]',
            'iframe[src*="viddler.com"]',
            'iframe[src*="qik.com"]',
            'iframe[src*="revision3.com"]',
            'iframe[src*="hulu.com"]',
            'iframe[src*="funnyordie.com"]',
            'iframe[src*="flickr.com"]',
            'embed[src*="v.wordpress.com"]'
        ];
        var allVideos = videoSelectors.join(',');
        $(allVideos).wrap('<span class="fluid-video" />');
    };
    responsiveVideoEmbed();

  	// Enable tooltips
    $('[data-toggle="tooltip"]').tooltip({
        delay: {
            "show": 500,
            "hide": 122200
        }
    });

    function heroMedia() {
        //Hero Slider
        function heroImage() {
            $('.hero__media__slider .slider').slick({
                fade: true,
                autoplay: true,
                autoplaySpeed: 10000,
                prevArrow: '<button type="button" class="slick-prev"><svg role="img" title="Left Arrow"><use xlink:href="img/tm-07/icon-pack.svg#left-arrow"></use></svg></button>',
                nextArrow: '<button type="button" class="slick-next"><svg role="img" title="Right Arrow"><use xlink:href="img/tm-07/icon-pack.svg#right-arrow"></use></svg></button>',
                appendArrows: $('<div></div>').addClass('section__slider-arrows hidden-xs').appendTo('.hero__search__links'),
            });
        }
        heroImage();
        // Hero Video
        function heroVideo() {
            var videoContainer = '.hero__video';
            $(videoContainer).YTPlayer({
                videoURL: $(videoContainer).data('video-url'),
                containment: videoContainer,
                loop: true,
                autoPlay: true,
                showControls: false,
                ratio: 'auto',
                quality: 'default',
                stopMovieOnBlur: false,
                playOnlyIfVisible: true,
            });
        }
        heroVideo();

        // Check if MediaType is defind and default if empty
        function heroMediaCheck() {
            var checkMediaType = $.trim($('.hero__media').data('media-type'));
            if(checkMediaType == 'video'){
                $('.hero__media__slider .slider').slick('unslick');
                $('.hero__media__slider').remove();
                $('.hero__media__video').show();
            } else if(checkMediaType == 'image'){
                $('.hero__media__video').remove();
                $('.hero__media__slider').show();
            } else {
                $('.hero__media__video').remove();
                $('.hero__media__slider').show();
            }
        }
        heroMediaCheck()
    }
    heroMedia();

    // Lazyload
    $('.section__lazyload').Lazy();
});